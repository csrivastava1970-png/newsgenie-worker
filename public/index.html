



<!doctype html>
<html lang="en">
<!-- NG_BUILD_STAMP_START -->
<meta name="ng-build-stamp" content="NG_BUILD_20260129_1045_IST">
<script>
  console.log("[NG_BUILD_STAMP]", "NG_BUILD_20260129_1045_IST");
</script>
<!-- NG_BUILD_STAMP_END -->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NewsGenie Digital Producer</title>
<link rel="icon" href="data:,">
  <!-- NG_STD_UI_TOOLBAR_ROW_V2_START -->

<style>
  /* NG_ADVANCED_PANELS_V1 */
  /* NG_ADV_ONLY_WRAP_V1 */
  html[data-ng-std-ui="simple"] #ng-adv-only{ display:none !important; }
  html[data-ng-std-ui="advanced"] #ng-adv-only{ display:block !important; }
#ng-preview-prompt-panel { display:none !important; }


  html[data-ng-std-ui="simple"] #ng-advanced-panels{ display:none !important; }
  html[data-ng-std-ui="simple"] #ng-byte-draft-box{ display:none !important; }
  html[data-ng-std-ui="advanced"] #ng-advanced-panels{ display:block; }
/* === NG_SOFT_NUDGE_V1_START (20260204) === */
#ngQuick.ng-soft-nudge {
  outline: none !important;
  box-shadow: 0 0 0 2px rgba(0,0,0,0.12) !important;

  border-radius: 8px;
  transition: box-shadow 180ms ease-in-out;
}
#ngQuick {
  transition: box-shadow 180ms ease-in-out;
}

html body #ngQuick.ng-soft-nudge{
  box-shadow: 0 0 0 2px rgba(0,0,0,0.12) !important;
}

/* === NG_SOFT_NUDGE_V1_END === */

  /* NG_STD_UI_TOOLBAR_ROW_V2
     Goal: single-row toolbar (actions left, UI toggle right) — CSS-only, hang-free
     Rules: NO DOM moving, NO MutationObserver, only CSS overrides.
  */

  /* 1) Layout: make page a simple grid so toolbar can be a row */
  body{
    display: grid;
    grid-template-columns: 1fr auto;
    grid-auto-rows: auto;
    column-gap: 12px;
    row-gap: 8px;
    align-items: start;
  }

  /* Title full width */
  h2{ grid-column: 1 / -1; grid-row: 1; }


  /* 2) Actions row (left) */
  #ng-dp-actions{
  grid-column: 1 / 2;
  grid-row: 2;

    grid-column: 1 / 2;
    align-self: center;

    display: flex !important;
    flex-wrap: nowrap !important;     /* override inline wrap */
    gap: 8px !important;
    align-items: center !important;

    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    min-width: 0;                    /* allow grid to size correctly */
  }

  body > #ng-dp-actions > button{
    flex: 0 0 auto;
    white-space: nowrap;
  }

  /* Hide horizontal scrollbar but keep scrolling */
  #ng-dp-actions{ scrollbar-width: none; }              /* Firefox */
  #ng-dp-actions::-webkit-scrollbar{ height: 0; }       /* Chrome/Edge */

  /* 3) If toggle is inside some wrapper, flatten that wrapper (CSS-only) */
 /* Flatten wrappers up to 4 levels so toggle becomes a grid item of body */
body *:has(> #ng-std-ui-toggle-root){ display: contents !important; }
body *:has(> * > #ng-std-ui-toggle-root){ display: contents !important; }
body *:has(> * > * > #ng-std-ui-toggle-root){ display: contents !important; }
body *:has(> * > * > * > #ng-std-ui-toggle-root){ display: contents !important; }


  /* Toggle: force normal flow + place it on toolbar row (right) */
  #ng-std-ui-toggle-root,
  #ng-std-ui-toggle-root .ngpill{
    position: static !important;
    inset: auto !important;
    top: auto !important;
    right: auto !important;
    bottom: auto !important;
    left: auto !important;
    transform: none !important;
    z-index: auto !important;
  }

  #ng-std-ui-toggle-root{
  grid-column: 2 / 3;
  grid-row: 2;

    grid-column: 2 / 3;
    align-self: center;
    justify-self: end;

    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;

    margin: 10px 0 !important;
    white-space: nowrap !important;
  }

  #ng-std-ui-toggle-root .ngpill{
    display: inline-flex !important;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  /* 4) Everything else should be full width below toolbar */
  /* default: anything that becomes a grid item spans full width */
body *{ grid-column: 1 / -1; }


  /* 5) Responsive: on narrower screens, drop toggle below + allow actions wrap */
 
<style>
    body { font-family: system-ui, Arial; margin: 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
    label { font-size: 12px; opacity: .8; display:block; margin-bottom:4px; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .panel { margin-top: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 12px; }
    pre { white-space: pre-wrap; word-wrap: break-word; margin: 0; }
    .status { font-size: 13px; }
    .muted { font-size:12px; opacity:.75; margin-top:6px; }
#btnBytesJSON { display: none !important; }
/* Force placement: Row-1 Title, Row-2 Toolbar (Actions + Toggle) */
h2{
  grid-column: 1 / -1 !important;
  grid-row: 1 !important;
}

#ng-dp-actions{
  grid-column: 1 / 2 !important;
  grid-row: 2 !important;
}

#ng-std-ui-toggle-root{
  grid-column: 2 / 3 !important;
  grid-row: 2 !important;
  justify-self: end !important;
  align-self: center !important;
}


  
/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}

/* NG_STD_UI_SIMPLE_HIDE_RESPONSE_V1 */
html[data-ng-std-ui="simple"] #ngResponse { display:none !important; }
html[data-ng-std-ui="simple"] #ng-response-panel { display:none !important; }

/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
/* === NG_OUTTABS_VISIBILITY_FIX_V1_START (20260206) === */
/* Make outtab selector robust: works if attribute is on <html> OR <body> OR any root wrapper */
html[data-ng-outtab], body[data-ng-outtab], [data-ng-outtab] {}

/* Ensure the response wrapper is allowed to show when any outtab is active */
html[data-ng-outtab] #ng-response-panel-wrap,
body[data-ng-outtab] #ng-response-panel-wrap,
[data-ng-outtab] #ng-response-panel-wrap{
  display: block !important;
}

/* Show ONLY the selected output panel (Story/Quick/Log/JSON) */
html[data-ng-outtab="story"] #ng-storyview,
body[data-ng-outtab="story"] #ng-storyview,
[data-ng-outtab="story"] #ng-storyview{ display:block !important; }

html[data-ng-outtab="quick"] #ng-quick-panel,
body[data-ng-outtab="quick"] #ng-quick-panel,
[data-ng-outtab="quick"] #ng-quick-panel{ display:block !important; }

html[data-ng-outtab="log"] #ng-log-panel,
body[data-ng-outtab="log"] #ng-log-panel,
[data-ng-outtab="log"] #ng-log-panel{ display:block !important; }

html[data-ng-outtab="json"] #ng-json-panel,
body[data-ng-outtab="json"] #ng-json-panel,
[data-ng-outtab="json"] #ng-json-panel{ display:block !important; }

/* Hide others by default (safe even if already hidden elsewhere) */
#ng-storyview, #ng-quick-panel, #ng-log-panel, #ng-json-panel{
  display:none;
}

/* === Height fix so Story panel cannot collapse === */
#ng-storyview{
  display:flex !important;
  flex-direction:column !important;
  min-height:360px !important;
}

#ng-storyview-out,
#ng-storyview-formatted{
  flex: 1 1 auto !important;
  height: 80vh !important;
  min-height:260px !important;
  overflow:auto !important;
}

/* === NG_OUTTABS_VISIBILITY_FIX_V1_END === */
/* === NG_HIDE_RAW_NGRESPONSE_V1_START (20260206) === */
#ngResponse { display:none !important; }
/* === NG_HIDE_RAW_NGRESPONSE_V1_END === */
/* === NG_JSON_TAB_MAPPING_V1_START (20260206) === */
html[data-ng-outtab="json"] #ng-json-panel-wrap,
body[data-ng-outtab="json"] #ng-json-panel-wrap,
[data-ng-outtab="json"] #ng-json-panel-wrap{
  display:block !important;
}
/* === NG_JSON_TAB_MAPPING_V1_END === */


/* === NG_HIDE_EMPTY_STORY_FORMATTED_V1_START (20260206) === */
#ng-storyview-formatted { display:none !important; }
/* === NG_HIDE_EMPTY_STORY_FORMATTED_V1_END === */

</style>
<style>
#ngQuick{ white-space:pre-wrap; overflow:auto; max-height:220px; }

/* NG_STD_UI_SIMPLE_HIDE_BYTES_V1_START */
body:has(#ng-std-ui-toggle-root [data-ng-mode="simple"].active) #bytesWrap {
  display: none !important;
}
body:has(#ng-std-ui-toggle-root [data-ng-mode="advanced"].active) #bytesWrap {
  display: block !important;
}
/* NG_STD_UI_SIMPLE_HIDE_BYTES_V1_END */


/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>
<style id="ng-simple-hide-bytes-v1">
  body:has(#ng-std-ui-toggle-root [data-ng-mode="simple"].active) .panel:has(#ng-sec-bytes){ display:none !important; }
body:has(#ng-std-ui-toggle-root [data-ng-mode="advanced"].active) .panel:has(#ng-sec-bytes){ display:block !important; }


/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}

/* === NG_OUTPUT_TABS_CSS_V1_START (20260206) === */
/* Tabs drive visibility via: html[data-ng-outtab="story|quick|raw|log"] */

/* STORY = show StoryView, hide Response/Quick/Log */
html[data-ng-outtab="story"] #ng-storyview{ display:block !important; }
html[data-ng-outtab="story"] #ng-response-panel-wrap{ display:none !important; }
html[data-ng-outtab="story"] #ng-quick-panel-wrap{ display:none !important; }
html[data-ng-outtab="story"] #ng-log-panel-wrap{ display:none !important; }

/* QUICK = show Quick only */
html[data-ng-outtab="quick"] #ng-storyview{ display:none !important; }
html[data-ng-outtab="quick"] #ng-response-panel-wrap{ display:none !important; }
html[data-ng-outtab="quick"] #ng-quick-panel-wrap{ display:block !important; }
html[data-ng-outtab="quick"] #ng-log-panel-wrap{ display:none !important; }

/* LOG = show Log only */
html[data-ng-outtab="log"] #ng-storyview{ display:none !important; }
html[data-ng-outtab="log"] #ng-response-panel-wrap{ display:none !important; }
html[data-ng-outtab="log"] #ng-quick-panel-wrap{ display:none !important; }
html[data-ng-outtab="log"] #ng-log-panel-wrap{ display:block !important; }

/* RAW = show Response (raw JSON), hide others */
html[data-ng-outtab="raw"] #ng-storyview{ display:none !important; }
html[data-ng-outtab="raw"] #ng-response-panel-wrap{ display:block !important; }
html[data-ng-outtab="raw"] #ng-quick-panel-wrap{ display:none !important; }
html[data-ng-outtab="raw"] #ng-log-panel-wrap{ display:none !important; }
/* === NG_OUTPUT_TABS_CSS_V1_END (20260206) === */

/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>

<style>
/* NG_TOOLBAR_LAYOUT_FIX_V1_START */
/* Layout-only: fixes shifted toolbar buttons without touching JS */
#ng-std-ui-toolbar-row,
#ng-std-ui-toggle-root,
#ng-dp-actions,
.ng-std-ui-toolbar-row,
.ng-toolbar {
  display: flex !important;
  flex-wrap: wrap !important;
  align-items: center !important;
  justify-content: flex-start !important;
  gap: 8px !important;
}

#ng-std-ui-toolbar-row > * ,
#ng-std-ui-toggle-root > * ,
#ng-dp-actions > * {
  margin: 0 !important;
}

#ng-std-ui-toolbar-row button,
#ng-std-ui-toggle-root button,
#ng-dp-actions button {
  position: static !important;
  transform: none !important;
}
/* NG_TOOLBAR_LAYOUT_FIX_V1_END */

/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>

<!-- NG_STORYVIEW_FORCE_SHOW_V1_START (20260130) -->
<style>
  body.ng-show-storyview #ng-storyview{ display:block !important; }

/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>
<!-- NG_STORYVIEW_FORCE_SHOW_V1_END -->
<!-- === NG_DRAFT_BYTE_FORCE_VISIBLE_V1_START (20260130) === -->
<style>
  /* Force Draft Byte box to have real layout box (fix 0x0 rect) */
  #ng-byte-draft-box{
    display:block !important;
    position:relative !important;
    width:100% !important;
    min-height: 60px !important;
    height:auto !important;
    overflow: visible !important;
    transform: none !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  #ng-byte-draft-text{
    display:block !important;
    width:100% !important;
    min-height: 90px !important;
    height:auto !important;
    transform: none !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>
<!-- === NG_DRAFT_BYTE_FORCE_VISIBLE_V1_END === -->


<!-- NG_DRAFT_LIBRARY_VISIBILITY_LOCK_CSS_V1_START (20260202) -->
<style>
  /* Draft Library panel: show in Advanced, hide in Simple (CSS-only override) */
  html[data-ng-std-ui='advanced'] #ng-draft-library { display:block !important; }
  html[data-ng-std-ui='simple']   #ng-draft-library { display:none !important; }

/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>
<!-- NG_DRAFT_LIBRARY_VISIBILITY_LOCK_CSS_V1_END -->

<!-- NG_MARKER: 2026-01-06_IST_TEST_123 -->


<!-- NG_HIDE_VIEW_DIGIPACK_V4_START (20260202) -->
<style>
  /* Hide View DIGI_PACK button in ALL modes (we auto-show preview after Generate) */
  #btnViewDigiPack { display:none !important; }

/* NG_BESTPRACTICE_BYTES_CONTROLS_V1 (20260203) */
#ng-bytes-controls-row{
  display:flex;
  flex-direction:column; /* mobile-first */
  gap:8px;
  align-items:flex-start;
  margin:10px 0 12px;
}
@media (min-width: 600px){
  #ng-bytes-controls-row{
    flex-direction:row; /* optional: wide screens */
    align-items:center;
  }
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
</style>
<!-- NG_HIDE_VIEW_DIGIPACK_V4_END -->
<style>
/* === NG_MINI_MODE_BTN_CSS_V1_START (20260205) === */
/* Segmented pill toggle for REAL / ECHO */
#ngRealModeWrap{
  display: inline-flex;
  align-items: center;
  border: 1px solid rgba(0,0,0,0.18);
  border-radius: 999px;
  overflow: hidden;
  background: rgba(0,0,0,0.02);
}

#ngRealModeWrap button{
  padding: 4px 12px;
  font-size: 12px;
  border: 0;
  background: transparent;
  cursor: pointer;
  line-height: 1.2;
}

#ngRealModeWrap button + button{
  border-left: 1px solid rgba(0,0,0,0.14);
}

#ngRealModeWrap .ng-mode-active{
  opacity: 1;
  font-weight: 800;
  background: rgba(0,0,0,0.08);
}

#ngRealModeWrap .ng-mode-idle{
  opacity: 0.6;
  font-weight: 600;
  background: transparent;
}

#ngRealModeWrap button:hover{
  background: rgba(0,0,0,0.06);
}
/* === NG_MINI_MODE_BTN_CSS_V1_END === */
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-tabs{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
  padding: 6px 8px !important;
  min-height: 34px !important;
  height: auto !important;
  flex-wrap: wrap !important;
}
/* === NG_OUTPUT_TABS_HEIGHT_FIX_V1_END === */
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_START (20260206) === */
#ng-output-headrow{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  padding: 6px 8px !important;
  min-height: 40px !important;
  height: auto !important;
}
/* === NG_OUTPUT_HEADROW_HEIGHT_FIX_V1_END === */
/* Hide duplicate top mini Quick/Story buttons (keep bottom output tabs) */
#btnQuickMini, #btnStoryMini { display: none !important; }

</style>
</head>
<body>
  <!-- NG_LEGACY_TOOLBAR_ROOTS_V1_START (20260205) -->
  <div id="ng-toolbar-root"></div>
  <div id="ng-std-ui-toggle-root"></div>
  <!-- NG_LEGACY_TOOLBAR_ROOTS_V1_END -->





<h2>NewsGenie Digital Producer</h2>

  <form id="digi-pack-form" onsubmit="return false;">





    <div class="row">


      <div>
        <label>Topic</label>
        <input name="topic" id="topic" placeholder="E.g., संसद प्रदूषण विवाद" required />

      </div>



      <div>
        <label>Platform</label>
        <select name="platform" id="platform">
          <option value="Digital">Digital</option>
          <option value="Both">Both</option>
          <option value="TV">TV</option>
        </select>
      </div>



      <div>
        <label>Angle (optional)</label>
        <input id="angle" name="angle" type="text" placeholder="Angle (optional) — 3–8 words" style="width:100%; padding:8px 10px; border:1px solid #ccc; border-radius:10px;" />
        
      </div>
    </div>

    <!-- STORY BASICS (moved up) -->
      <label>Story Type</label>
      <select name="storyType" id="storyType" required>
        <option value="">Select</option>
        <option value="breaking">Breaking</option>
        <option value="developing">Developing</option>
        <option value="explainer">Explainer</option>
        <option value="debate">Debate</option>
      </select>
    </div>



    <div style="margin-top:10px;">
      <label>What Happened (mandatory)</label>
      <textarea name="whatHappened" id="whatHappened" rows="3" placeholder="2–4 lines में क्या हुआ?" required></textarea>

    </div>



    <div style="margin-top:10px;">
      <label>Sources / References (mandatory)</label>
      <textarea name="sources" id="sources" rows="3" placeholder="Links / documents / official statements" required></textarea>
    </div>



    <div style="margin-top:10px;">
      <label>Background (optional but counts)</label>
      <textarea name="background" id="background" rows="3" placeholder="Context / past events / why it matters"></textarea>
    </div>
    <!-- STORY BASICS END -->

<!-- ========================= -->
<!-- ========================= -->
<!-- Transcript JSON Loader -->
<!-- ========================= -->
<section id="ng-transcript-loader" style="margin-top:12px; padding:12px; border:1px solid #ddd; border-radius:12px;">
  <!-- Compact tools bar -->


  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">


    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
      <h3 style="margin:0; font-size:14px;">Transcript Tools</h3>
      <button type="button" id="btn-load-transcript-json" class="primary">Load</button>
      <button type="button" id="btn-refresh-latest-transcript" style="padding:8px 10px;border:1px solid #999;border-radius:10px;cursor:pointer;background:#f7f7f7;">Refresh Latest (API)</button>
      <button type="button" id="btn-paste-transcript-json">Paste</button>
      <button type="button" id="btn-import-transcript-json">Import</button>
      <input type="file" id="file-transcript-json" accept=".json,application/json,.txt" style="display:none;">
    </div>



    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <span style="font-size:12px;opacity:.7;">Status:</span>
      <span id="ng-latest-transcript-status" style="font-size:12px;opacity:.85;">(not loaded)</span>
      <span id="transcript-load-hint" style="font-size:12px; opacity:.75;"></span>
    </div>
  </div>

  <!-- Collapsible inbox (keeps UI light) -->
  <details id="ng-transcript-inbox-details" style="margin-top:10px;">
    <summary style="cursor:pointer; user-select:none; font-size:13px; opacity:.85;">Transcript Inbox</summary>



    <div style="margin-top:10px;">


      <div id="ng-transcript-inbox-hint" style="margin-top:8px;font-size:12px;opacity:.75;">Paste Reverie JSON here (display_text or text). Load saves to localStorage.</div>
      <textarea id="ta-transcript-json" rows="8"
        style="width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:12px; line-height:1.35; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px;"
        placeholder="Paste JSON here..."></textarea>



      <div style="display:flex; gap:8px; margin-top:10px; align-items:center; flex-wrap:wrap;">
        <button type="button" id="btn-clear-transcript-json">Clear Saved</button>
      </div>



      <div id="ng-latest-transcript-preview"
        style="display:none;white-space:pre-wrap;max-height:160px;overflow:auto;border:1px dashed #bbb;border-radius:12px;padding:10px;font-size:13px;opacity:.9; margin-top:10px;"></div>
    </div>
  </details>
</section>

<!-- NG_SUPERLIGHT_TRANSCRIPT_TO_BYTES_V1_START -->


<div id="ng-superlight" style="margin-top:12px; display:grid; grid-template-columns: 1fr; gap:10px;">


  <div class="panel" id="ng-sec-transcript-lines">
    <b>Transcript Lines</b>


    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px;">
      <button type="button" id="ng-lines-selectall">Select All</button>
      <button type="button" id="ng-lines-clear">Clear Selection</button>
      <span id="ng-lines-status" style="font-size:12px; opacity:.75;"></span>
    </div>


    <div id="ng-lines-wrap" style="margin-top:10px; display:flex; flex-direction:column; gap:8px; max-height:220px; overflow:auto; border:1px solid #eee; border-radius:12px; padding:10px;"></div>
  </div>

  </div>
</div>
<!-- NG_SUPERLIGHT_TRANSCRIPT_TO_BYTES_V1_END -->



    <div id="ng-adv-only" style="margin-top:10px;">

   <!-- BYTES -->


<div class="panel" id="bytesWrap" data-ng-sec="bytes">
  <b>Bytes</b>



  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:8px;flex-wrap:wrap;">


    <div style="font-size:12px;opacity:.75;">Add bytes from selection or paste/type manually.</div>
  </div>

  <!-- FINAL BYTES HOST (static) -->


  <div style="margin-top:10px;font-weight:600;">Final Bytes</div>


  <div id="ng-final-bytes-list-auto" style="margin-top:8px;"></div>

  <script>

</script>
<script>
/* NG_BYTES_WRAP_HEIGHT_FIX_V1_START */
(function(){
  if (window.__NG_BYTES_WRAP_HEIGHT_FIX_V1) return;
  window.__NG_BYTES_WRAP_HEIGHT_FIX_V1 = true;

  function apply(){
    const w = document.querySelector("#bytes-wrap");
    if (!w) return false;
    // undo any accidental "height:0" style
    w.style.height = "auto";
    w.style.minHeight = "1px";
    w.style.overflow = "visible";
    return true;
  }

  if (apply()) return;
  let n=0;
  const t=setInterval(()=>{ n++; if (apply() || n>30) clearInterval(t); }, 200);
})();
 /* NG_BYTES_WRAP_HEIGHT_FIX_V1_END */
</script>
<script>
/* NG_MANUAL_BYTES_UNHIDE_ON_ADD_V1_START */
(function(){
  if (window.__NG_MANUAL_BYTES_UNHIDE_ON_ADD_V1) return;
  window.__NG_MANUAL_BYTES_UNHIDE_ON_ADD_V1 = true;

  function unhide(){
    const m = document.querySelector("#ng-manual-bytes");
    if (m) m.style.display = "block";
  }

  // unhide once on load (safe)
  setTimeout(unhide, 0);

  // and whenever + Add Byte is clicked
  document.addEventListener("click", (e)=>{
    if (e.target && e.target.id === "addByteBtn") setTimeout(unhide, 0);
  }, true);
})();
 /* NG_MANUAL_BYTES_UNHIDE_ON_ADD_V1_END */
</script>
<script>
/* NG_MOVE_ADD_FINAL_BTN_V1_START */
(function(){
  if (window.__NG_MOVE_ADD_FINAL_BTN_V1) return;
  window.__NG_MOVE_ADD_FINAL_BTN_V1 = true;

  function move(){
    const btn = document.querySelector("#ng-add-final");
    const target = document.querySelector("#ng-manual-bytes");
    const wrap = document.querySelector("#bytes-wrap");
    if (!btn || !target || !wrap) return false;

    // ensure manual bytes visible
    target.style.display = "block";

    // create a stable holder below bytes-wrap
    let holder = document.querySelector("#ng-add-final-holder");
    if (!holder){
      holder = document.createElement("div");
      holder.id = "ng-add-final-holder";
      holder.style.cssText = "margin-top:10px; display:flex; justify-content:flex-end;";
      wrap.insertAdjacentElement("afterend", holder);
    }

    // move only if not already there
    if (!holder.contains(btn)) holder.appendChild(btn);

    // ensure visible sizing
    btn.style.display = "inline-block";
    btn.style.visibility = "visible";
    btn.style.opacity = "1";
    return true;
  }

  if (move()) return;
  let n=0;
  const t=setInterval(()=>{ n++; if (move() || n>30) clearInterval(t); }, 200);
})();
 /* NG_MOVE_ADD_FINAL_BTN_V1_END */
</script>
<script>
</script>
        <button type="button" class="btn" id="addByteBtn">+ Add Byte</button>
      </div>

            
<!-- NG_BYTES_UNIFIED_DRAFT_V1_START -->


<div id="ng-byte-draft-area" style="margin-top:10px; display:none;">


  <div id="ng-byte-draft-box" style="margin-top:10px;padding:10px;border:1px dashed #cbd5e1;border-radius:12px;">


    <div style="font-size:12px;opacity:.8;margin-bottom:6px;">Draft Byte (select transcript lines OR paste/type manually)</div>

    <textarea
      id="ng-byte-draft-text"
      rows="4"
      style="width:100%; padding:10px; border:1px solid #ccc; border-radius:10px;"
      placeholder="Selected lines will appear here... (or paste/type)"
    ></textarea>



    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <input
        id="ng-byte-draft-speaker"
        type="text"
        placeholder="Speaker (manual)"
        style="padding:8px 10px; border:1px solid #ccc; border-radius:10px; min-width:220px;"
      >
      <input
        id="ng-byte-draft-desig"
        type="text"
        placeholder="Designation (manual)"
        style="padding:8px 10px; border:1px solid #ccc; border-radius:10px; min-width:260px;"
      >
    </div>



    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; align-items:center;">
      <button type="button" id="ng-make-byte" class="secondary">Make Draft from Selection</button>
      <button type="button" id="ng-add-final" class="primary">Add to Bytes</button>
      <button type="button" id="ng-clear-draft">Clear Draft</button>
      <span id="ng-byte-draft-status" style="font-size:12px; opacity:.75;"></span>
    </div>
  </div>
</div>
<!-- NG_BYTES_UNIFIED_DRAFT_V1_END -->
<!-- NG_DRAFT_LIBRARY_PANEL_V1_START (20260130) -->


<div id="ng-draft-library" class="panel" style="display:none;">
  <details id="ng-draft-lib-details">
    <summary style="cursor:pointer; font-weight:700;">Draft Library</summary>



    <div style="margin-top:10px;">
      <button type="button" id="ng-lib-refresh">Refresh</button>
      <button type="button" id="ng-lib-clear">Clear Library</button>

      <pre id="ng-lib-out" style="margin-top:10px;white-space:pre-wrap;max-height:220px;overflow:auto;border:1px solid #eee;border-radius:12px;padding:10px;"></pre>
    </div>
  </details>
</div>




  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
    <button type="button" id="ng-lib-refresh">Refresh</button>
    <button type="button" id="ng-lib-clear">Clear Library</button>
  </div>

  <pre id="ng-lib-out" style="margin-top:10px;white-space:pre-wrap;max-height:220px;overflow:auto;border:1px solid #eee;border-radius:12px;padding:10px;"></pre>
</div>
<!-- NG_DRAFT_LIBRARY_PANEL_V1_END -->



      <!-- hidden JSON sink for Final Bytes module -->
      <textarea id="bytesJSONOut" style="display:none;"></textarea>


      <div id="ng-manual-bytes" style="margin-top:10px; display:none;"><div id="bytes-wrap"></div></div>
    </div>
    <!-- VISUALS -->
<!-- NG_STD_VISUALS_WRAP_V1_START -->


<div id="visualsWrap" data-ng-sec="visuals">


  <div class="panel" id="step-visuals">
    <details id="ng-visuals-details">
      <summary style="cursor:pointer; font-weight:700;">Visuals</summary>



      <div style="margin-top:10px;">


        <div class="muted">B-roll / archive / location visuals (multiple rows)</div>



        <div id="visuals-wrap"></div>



        <div style="margin-top:8px;">
          <button type="button" id="add-visual">+ Add Visual</button>
        </div>
      </div>
    </details>
  </div>
</div>
<!-- NG_STD_VISUALS_WRAP_V1_END -->





    <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
      <button id="btnGenerate" type="button" class="primary" onclick="generateDigiPack(event)" disabled>
        Generate DIGI_PACK
      </button>

      <button type="button" class="secondary" onclick="clearUI()">Clear</button>

<button id="btnCopyDigiPack" type="button" class="secondary" disabled title="Shift+Click: Copy JSON">Copy</button>
<button id="btnViewDigiPack" type="button" class="secondary" disabled>View DIGI_PACK</button>

      <span id="genStatus" style="font-size:13px; opacity:.8;"></span>
    </div>
  </form>
<!-- Editorial Extraction : Suggestions ONLY -->




<div id="ng-advanced-panels">


  <div class="panel" id="ng-log-panel-wrap"><div id="ng-output-headrow" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">


  <div class="status" style="margin:0;"><b>Status:</b> <span id="ngStatus">Idle</span></div>


  <div id="ng-output-tabs" style="display:flex; gap:8px; flex-wrap:wrap; margin:0;">
    <button type="button" class="btn" id="ng-tab-story">Story</button>
    <button type="button" class="btn" id="ng-tab-quick">Quick</button>
    <button type="button" class="btn" id="ng-tab-log">Log</button>
    <button type="button" class="btn" id="ng-tab-raw">JSON</button>

  </div>
</div>




  <details id="ng-log-details">
    <summary style="cursor:pointer; font-weight:700;">Log</summary>
    <pre id="ngLog" style="margin-top:10px; max-height:160px; overflow:auto;"></pre>
  </details>
</div>

  </div>



  <div class="panel" id="ng-quick-panel-wrap">


  <div id="ng-quick-panel">

  <details id="ng-quick-details">
    <summary style="cursor:pointer; font-weight:700;">Quick View</summary>


    <div id="ngQuick" style="margin-top:10px; white-space:pre-wrap; overflow:auto; max-height:180px;">(no quick view)</div>
  </details>
</div>


  </div>



 <div class="panel" id="ng-response-panel-wrap">


  <div id="ng-response-panel">

  <details id="ng-response-details">
    <summary style="cursor:pointer; font-weight:700;">Response</summary>
    <pre id="ngResponse" style="margin-top:10px;">(no response yet)</pre>
  </details>
</div>

<!-- NG_STORYVIEW_PANEL_V1_START (20260130) -->


<div id="ng-storyview" class="panel" style="display:none;">
  <b>Story View</b>
<button type="button" class="btn" id="ngCopyStoryView">Copy Story</button>



  <div style="font-size:12px;opacity:.75;margin-top:6px;">
    DIGI_PACK Story View (readable output for editorial use).
  </div>
<!-- NG_STORYVIEW_FORMATTED_V1_START -->


<div id="ng-storyview-formatted" style="margin-top:10px;"></div>
<!-- NG_STORYVIEW_FORMATTED_V1_END -->

  <pre id="ng-storyview-out" style="margin-top:10px;white-space:pre-wrap;max-height:320px;overflow:auto;border:1px solid #eee;border-radius:12px;padding:10px;"></pre>
</div>
<!-- NG_STORYVIEW_PANEL_V1_END (20260130) -->
<!-- === NG_JSON_PANEL_V1_START (20260206) === -->
<div id="ng-json-panel-wrap" class="panel" style="display:none;">
  <b>Raw JSON</b>
  <div style="margin:6px 0 10px; opacity:.75; font-size:12px;">
    Advanced view (debug/export). Story tab में readable text रहेगा।
  </div>
  <pre id="ng-json-out" style="white-space:pre-wrap; font-family:ui-monospace,monospace; font-size:13px; line-height:1.4; overflow:auto; min-height:260px; padding:10px; border:1px solid rgba(0,0,0,0.12); border-radius:12px;"></pre>
</div>
<!-- === NG_JSON_PANEL_V1_END === -->


  </div>


<div class="panel" id="ng-preview-prompt-panel">



  <div style="display:flex;align-items:center;justify-content:space-between;">
    <b>Preview Prompt (will be sent)</b>
    <button type="button" id="copy-prompt"
      style="padding:6px 10px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer;">
      Copy
    </button>
  </div>

  <textarea id="prompt-preview" readonly
    style="width:100%;min-height:160px;margin-top:8px;padding:10px;
           border:1px solid #ccc;border-radius:10px;
           font-family:ui-monospace,Consolas,monospace;
           font-size:12px;"></textarea>
</div>

</div><!-- /#ng-advanced-panels -->
<script>
/* NG_ANGLE_WIRE_V1_START */
(function(){
  try{
    var el = document.getElementById('angle');
    if(!el) return;

    var key = 'ng_story_angle_v1';

    // restore
    try{
      var saved = localStorage.getItem(key) || '';
      if(saved && !el.value) el.value = saved;
    }catch(e){}

    // persist
    el.addEventListener('input', function(){
      try{ localStorage.setItem(key, el.value || ''); }catch(e){}
    });

    window.NG_getAngle = function(){ return (el && el.value ? String(el.value).trim() : ''); };

    if(typeof window.NG_getStoryMeta === 'function' && !window.NG_getStoryMeta.__ng_angle_wrapped){
      var _orig = window.NG_getStoryMeta;
      var _wrap = function(){
        var o = {};
        try { o = _orig() || {}; } catch(e){ o = {}; }
        o.angle = window.NG_getAngle();
        return o;
      };
      _wrap.__ng_angle_wrapped = true;
      window.NG_getStoryMeta = _wrap;
    } else if(typeof window.NG_getStoryMeta !== 'function'){
      window.NG_getStoryMeta = function(){ return { angle: window.NG_getAngle() }; };
    }
  }catch(e){
    console.warn('NG_ANGLE_WIRE_V1 error', e);
  }
})();
</script>
<!-- NG_ANGLE_WIRE_V1_END -->


<!-- NG_FALLBACKS_CONSOLIDATED_V1_START -->
<script>
/* === Editorial Extraction : Suggestions Panel + Transcript Auto-Ingest (Clean V3) === */
"use strict";

/* Consolidated fallbacks (single copy). Logic unchanged; structure tidied. */
(function(){
  if (window.__NG_FALLBACKS_CONSOLIDATED_V1__) return;
  window.__NG_FALLBACKS_CONSOLIDATED_V1__ = true;
})();


  /* ===============================
     NG_refreshFinalBytes (RESTORE)
     =============================== */
  window.NG_refreshFinalBytes = async function NG_refreshFinalBytes(){
    try {
      const host =
        document.querySelector("#ng-final-bytes-list-auto") ||
        document.querySelector("#ng-final-bytes-host") ||
        document.querySelector("#finalBytesList") ||
        document.querySelector("#final-bytes-list") ||
        document.querySelector("[data-ng-final-bytes-host]");

      if (!host) {
        console.warn("[NG_refreshFinalBytes] host not found");
        return { ok:false, reason:"host_not_found" };
      }

      const r = await fetch("/api/bytes/latest", { cache: "no-store" });
      const data = await r.json().catch(()=>null);

      const bytes =
        (data && Array.isArray(data.bytes) && data.bytes) ||
        (data && data.latest && Array.isArray(data.latest.bytes) && data.latest.bytes) ||
        [];

      // Optional: also update any JSON textarea if present
      const ta =
        document.querySelector("#finalBytesJSONOut") ||
        document.querySelector("#ng-final-bytes-json") ||
        document.querySelector("[data-ng-final-bytes-json]");

      if (ta && "value" in ta) {
        try { ta.value = JSON.stringify(bytes, null, 2); } catch(e){}
      }

      // Render cards
      host.innerHTML = "";
      const frag = document.createDocumentFragment();

      bytes.forEach((b, idx) => {
        const sp = String(b?.speaker ?? "").trim();
        const de = String(b?.designation ?? "").trim();
        const tx = String(b?.text ?? "").trim();
        if (!tx) return;

        const card = document.createElement("div");
        card.className = "ng-final-card";
        card.style.cssText = "border:1px solid #e5e7eb;border-radius:12px;padding:10px;margin:8px 0;background:#fff;";

        const top = document.createElement("div");
        top.style.cssText = "display:flex;justify-content:space-between;gap:10px;align-items:flex-start;";

        const who = document.createElement("div");
        who.style.cssText = "font-size:12px;opacity:.85;";
        who.textContent = (sp || de) ? `${sp}${(sp && de) ? " — " : ""}${de}` : `Byte ${idx+1}`;

        const tag = document.createElement("div");
        tag.style.cssText = "font-size:11px;opacity:.6;";
        tag.textContent = "Final";

        const quote = document.createElement("div");
        quote.style.cssText = "margin-top:6px;font-size:13px;line-height:1.35;white-space:pre-wrap;";
        quote.textContent = tx;

        top.appendChild(who);
        top.appendChild(tag);
        card.appendChild(top);
        card.appendChild(quote);

        frag.appendChild(card);
      });

      host.appendChild(frag);
      return { ok:true, count: bytes.length };
    } catch (e) {
      console.warn("[NG_refreshFinalBytes] failed", e);
      return { ok:false, error: String(e?.message || e) };
    }
  };

  /* ===============================
     NG_ADD_BYTE_FALLBACK_V1
     =============================== */
  (function(){
    if (window.__NG_ADD_BYTE_FALLBACK_V1) return;
    window.__NG_ADD_BYTE_FALLBACK_V1 = true;

    function escAttr(s){ return String(s??"").replace(/"/g,"&quot;"); }

    function addRow(){
      const wrap = document.querySelector("#bytes-wrap");
      if (!wrap) return;
const defSp = "";
const defDe = "";

      const row = document.createElement("div");
      row.className = "ng-byte-row";
      row.style.cssText = "display:grid;grid-template-columns:1fr 1fr auto;gap:8px;margin-top:10px;padding:10px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;align-items:start;";

      row.innerHTML = `
        <input class="ng-byte-speaker" placeholder="Speaker" value="${escAttr(defSp)}" style="padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px;">
        <input class="ng-byte-desig" placeholder="Designation" value="${escAttr(defDe)}" style="padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px;">
        
        <textarea class="ng-byte-text" placeholder="Quote / Byte text" rows="3" style="grid-column:1 / -1; padding:10px;border:1px solid #e5e7eb;border-radius:10px;"></textarea>
<button type="button" class="danger ng-byte-remove" style="grid-column:1 / -1; justify-self:end; padding:8px 12px;border-radius:10px;border:1px solid #ef4444;background:#fff;">Remove</button>

      `;

      row.querySelector(".ng-byte-remove").addEventListener("click", () => row.remove());
      wrap.appendChild(row);
    }

    function bind(){
  if (window.__NG_ADD_BYTE_MULTIROW_V3__) return true;
  if (window.__NG_ADD_BYTE_MULTIROW_V3_2__) return true;

  const btn = document.querySelector("#addByteBtn");
  const wrap = document.querySelector("#bytes-wrap");
  if (!btn || !wrap) return false;

  if (!btn.dataset.ngBoundFallback) {

        btn.dataset.ngBoundFallback = "1";
        btn.addEventListener("click", () => {
          setTimeout(() => {
            const any = wrap.querySelector(".ng-byte-row, textarea, input");
            if (!any) addRow();
            else {
              const hasRow = wrap.querySelector(".ng-byte-row, textarea.ng-byte-text");
              if (!hasRow) addRow();
            }
          }, 0);
        }, true);
      }
      return true;
    }

    if (bind()) return;
    let tries = 0;
    const t = setInterval(() => {
      tries++;
      if (bind() || tries > 25) clearInterval(t);
    }, 200);
  })();

  /* ===============================
     NG_ADD_FINAL_SYNC_FALLBACK_V1
     =============================== */
  (function(){
    if (window.__NG_ADD_FINAL_SYNC_FALLBACK_V1) return;
    window.__NG_ADD_FINAL_SYNC_FALLBACK_V1 = true;

    function collectBytes(){
      const wrap = document.querySelector("#bytes-wrap");
      if (!wrap) return [];
      const rows = [...wrap.querySelectorAll(".ng-byte-row")];
      const out = [];
      for (const r of rows){
        const sp = (r.querySelector(".ng-byte-speaker")?.value || "").trim();
        const de = (r.querySelector(".ng-byte-desig")?.value || "").trim();
        const tx = (r.querySelector(".ng-byte-text")?.value || "").trim();
        if (!tx) continue;
        out.push({ speaker: sp, designation: de, text: tx });
      }
      return out;
    }

    async function post(bytes){
      const r = await fetch("/api/bytes/latest",{
        method:"POST",
        headers: {"content-type":"application/json"},
        body: JSON.stringify({ bytes, source:"ui_add_final_fallback_v1", ts:new Date().toISOString() })
      });
      return r.json().catch(()=>null);
    }

    async function syncNow(){
      try{
        const bytes = collectBytes();
        await post(bytes);
        // after sync, refresh final cards too (best-effort)
        if (typeof window.NG_refreshFinalBytes === "function") {
          setTimeout(() => window.NG_refreshFinalBytes(), 0);
        }
      }catch(e){
        console.warn("[NG_ADD_FINAL_SYNC_FALLBACK_V1] sync failed", e);
      }
    }

    window.NG_syncFinalBytesNow = syncNow;

    document.addEventListener("click", (e)=>{
      if (e.target && e.target.id === "ng-add-final"){
        setTimeout(syncNow, 0);
      }
      if (e.target && e.target.classList && e.target.classList.contains("ng-byte-remove")){
        setTimeout(syncNow, 0);
      }
    }, true);
  })();

</script>
<!-- NG_FALLBACKS_CONSOLIDATED_V1_END -->


<script> /* NG_FINAL_BYTES_UI_POLL_V1_START */ (function () {
  if (window.__NG_FINAL_BYTES_UI_POLL_V1_INSTALLED) return;
  window.__NG_FINAL_BYTES_UI_POLL_V1_INSTALLED = true;

  function esc(s){return String(s??"").replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

  function ensureHost() {
    let host = document.querySelector("#ng-final-bytes-list-auto");
    if (!host) {
      const TARGET = document.querySelector("#bytes-wrap") || document.querySelector("#bytesWrap") || document.querySelector("#ng-adv-only") || document.body;
      host = document.createElement("div");
      host.id = "ng-final-bytes-list-auto";
      host.style.cssText = "margin-top:10px;";
      TARGET.appendChild(host);
    }

    let label = document.querySelector("#ng-final-bytes-count-label");
    if (!label) {
      label = document.createElement("div");
      label.id = "ng-final-bytes-count-label";
      label.style.cssText = "font-size:12px;opacity:.85;margin:6px 0 10px 0;display:block;";
      host.insertBefore(label, host.firstChild);
    }

    let cards = document.querySelector("#ng-final-bytes-cards-v1");
    if (!cards) {
      cards = document.createElement("div");
      cards.id = "ng-final-bytes-cards-v1";
      cards.style.cssText = "margin-top:10px; display:flex; flex-direction:column; gap:8px;";
      host.appendChild(cards);
    }

    // Add a manual refresh button (explicit user action)
    let btn = document.querySelector("#ng-final-bytes-refresh-btn");
    if (!btn) {
      btn = document.createElement("button");
      btn.type = "button";
      btn.id = "ng-final-bytes-refresh-btn";
      btn.textContent = "Refresh Final Bytes";
      btn.style.cssText = "padding:6px 10px;border-radius:10px;border:1px solid #999;background:#f7f7f7;cursor:pointer;font-size:12px;";
      label.insertAdjacentElement("afterend", btn);
      btn.addEventListener("click", () => {
        try { window.NG_refreshFinalBytes && window.NG_refreshFinalBytes(); } catch(e){}
      }, true);
    }

    return { host, label, cards };
  }

  function render(bytes) {
    const ui = ensureHost();
    const arr = Array.isArray(bytes) ? bytes : [];
    ui.label.textContent = `Final Bytes • ${arr.length}`;

    const draftStatus = document.querySelector("#ng-byte-draft-status");
    if (draftStatus) draftStatus.textContent = `Final Bytes • ${arr.length}`;

    if (!arr.length) {
      ui.cards.innerHTML = `<div style="font-size:12px;opacity:.6;border:1px dashed #e2e8f0;border-radius:12px;padding:10px;">Final Bytes empty</div>`;
      return;
    }

    ui.cards.innerHTML = arr.map((b, i) => {
      const sp = esc(b.speaker || "");
      const des = esc(b.designation || "");
      const tx = esc(b.text || "");
      const head = (sp || des) ? `<div style="font-size:12px;opacity:.85;margin-bottom:6px;"><b>${sp || "—"}</b>${des ? ` • ${des}` : ""}</div>` : "";
      return `<div class="ng-final-card" data-idx="${i}" style="border:1px solid #e5e7eb;border-radius:12px;padding:10px;background:#fff;">
        ${head}


        <div style="font-size:14px;line-height:1.3;">${tx || "<span style='opacity:.6'>—</span>"}</div>
      </div>`;
    }).join("");
  }

  // STRICT: only allow GET when explicitly requested (one-shot flag)
  async function tick(reason) {
    try {
      if (!window.__NG_ALLOW_BYTES_LATEST_ONCE) return;
      window.__NG_ALLOW_BYTES_LATEST_ONCE = false;
    } catch (e) { /* ignore */ }
  }

  try { if (typeof _t !== "undefined" && _t) ingestSoon(_t, "boot"); } catch (e) {}
})();

  // ---------------- Transcript JSON Loader ----------------
  (function initTranscriptJsonLoader() {
    const LS_KEY = "NG_REVERIE_TRANSCRIPT_JSON_V1";
    function $(id){ return document.getElementById(id); }

    function extractTranscriptText(obj) {
      if (typeof obj === "string") return obj;

      if (obj && typeof obj.display_text === "string" && obj.display_text.trim()) return obj.display_text;
      if (obj && typeof obj.text === "string" && obj.text.trim()) return obj.text;

      const cands = [obj?.result, obj?.output, obj?.data, obj?.transcript, obj?.transcription].filter(Boolean);
      for (const c of cands) {
        if (typeof c?.display_text === "string" && c.display_text.trim()) return c.display_text;
        if (typeof c?.text === "string" && c.text.trim()) return c.text;
      }

      const segs =
        obj?.segments || obj?.result?.segments || obj?.output?.segments || obj?.data?.segments ||
        obj?.utterances || obj?.result?.utterances || obj?.items;

      if (Array.isArray(segs) && segs.length) {
        const parts = segs.map(s =>
          (typeof s?.display_text === "string" && s.display_text.trim()) ? s.display_text :
          (typeof s?.text === "string" && s.text.trim()) ? s.text :
          (typeof s?.utterance === "string" && s.utterance.trim()) ? s.utterance :
          ""
        ).filter(Boolean);
        if (parts.length) return parts.join("\n");
      }

      return "";
    }

    function loadFromTextarea() {
      const ta = $("ta-transcript-json");
      if (!ta) return;

      const raw = (ta.value || "").trim();
      if (!raw) return;

      try { localStorage.setItem(LS_KEY, raw); } catch {}

      let parsed;
      try { parsed = JSON.parse(raw); } catch { parsed = raw; }

      const text = extractTranscriptText(parsed) || (typeof parsed === "string" ? parsed : "");
      window.NG_TRANSCRIPT = text; // ✅ sets extracted text
      console.log("[TL] NG_TRANSCRIPT set. chars:", (text || "").length);
    }

    function boot() {
      const ta = $("ta-transcript-json");
      const btn = $("btn-load-transcript-json");

      try {
        const saved = localStorage.getItem(LS_KEY);
        if (ta && saved && !ta.value.trim()) ta.value = saved;
      } catch {}

      if (btn && !btn.__NG_BOUND) {
        btn.__NG_BOUND = true;
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          loadFromTextarea();
        });
      }
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", boot, { once: true });
    } else {
      boot();
    }
})();  // ✅ close Transcript Loader IIFE


  // ---------------- export global + auto init ----------------

  
</script>

<!-- NG_SMOKE_TEST_BUTTON_V1_START -->
<!-- NG_SMOKE_VIS_TOGGLE_V1_START (20260203) -->
<script>
(function(){
  function apply(){
    try{
      var b = document.getElementById("ng-smoke-test");
      if (!b) return;
      var on = (new URLSearchParams(location.search).get("smoke") === "1");
      // force with !important to override any CSS or later scripts
      b.style.setProperty("display", on ? "inline-flex" : "none", "important");
    }catch(e){}
  }
  apply();
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", apply, { once:true });
  }
  setTimeout(apply, 200);
})();
</script>
<!-- NG_SMOKE_VIS_TOGGLE_V1_END -->

<script>
(function(){
  const btn = document.getElementById("ng-smoke-test");
  if (!btn || btn.dataset.bound) return;
  btn.dataset.bound = "1";

  async function run(){
    const out = { ts: new Date().toISOString(), checks: [] };

    function ok(name, extra){ out.checks.push({ name, ok:true, ...extra }); }
    function bad(name, extra){ out.checks.push({ name, ok:false, ...extra }); }

    // Check: build stamp
    const stamp = document.querySelector('meta[name="ng-build-stamp"]')?.getAttribute('content') || null;
    stamp ? ok("build_stamp", { stamp }) : bad("build_stamp");

    // Check: health
    try{
      const h = await fetch("/api/health", { cache:"no-store" }).then(r=>r.json());
      h?.ok ? ok("api_health", { h }) : bad("api_health", { h });
    }catch(e){ bad("api_health", { error: String(e?.message||e) }); }

    // Check: bytes latest
    try{
      const b = await fetch("/api/bytes/latest", { cache:"no-store" }).then(r=>r.json());
      const n = Array.isArray(b?.bytes) ? b.bytes.length : (Array.isArray(b?.latest?.bytes) ? b.latest.bytes.length : 0);
      ok("api_bytes_latest", { count: n, payload: b });
    }catch(e){ bad("api_bytes_latest", { error: String(e?.message||e) }); }

    // Check: refresh function + render host
    const host = document.querySelector("#ng-final-bytes-list-auto");
    host ? ok("final_bytes_host") : bad("final_bytes_host");

    if (typeof window.NG_refreshFinalBytes === "function") ok("NG_refreshFinalBytes_exists");
    else bad("NG_refreshFinalBytes_exists");

    // Try render
    try{
      if (typeof window.NG_refreshFinalBytes === "function") {
        const r = await window.NG_refreshFinalBytes();
        const cards = document.querySelectorAll(".ng-final-card").length;
        ok("NG_refreshFinalBytes_run", { ret: r, cards });
      }
    }catch(e){ bad("NG_refreshFinalBytes_run", { error: String(e?.message||e) }); }

 console.log("[NG_SMOKE_TEST]", out);
// Show results on-page (no console dependency) — DEV ONLY (box)
const __NG_SMOKE_ON__ = new URLSearchParams(location.search).get("smoke") === "1";

/*
  DEV-ONLY: hide Smoke button on normal URLs.
  NOTE: Best practice is to ALSO hide on page-load (outside run()).
  This line ensures that once run() executes, the button state is correct.
*/
const __btn = document.getElementById("ng-smoke-test");
// (NG_CLEANUP_20260203) display handled by NG_SMOKE_VIS_TOGGLE_V1

// DEV-OFF: no box/no further work
if (!__NG_SMOKE_ON__) return out;


// DEV-ON: show box
let box = document.getElementById("ng-smoke-out");
if (!box) {
  box = document.createElement("pre");
  box.id = "ng-smoke-out";
  box.style.cssText =
    "position:fixed;right:16px;bottom:64px;z-index:9999;max-width:520px;max-height:320px;" +
    "overflow:auto;padding:10px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;" +
    "box-shadow:0 6px 18px rgba(0,0,0,.08);font-size:11px;white-space:pre-wrap;";
  document.body.appendChild(box);
}

box.style.cursor = "pointer";
box.textContent = "[NG_SMOKE_TEST]\n" + JSON.stringify(out, null, 2);
box.onclick = () => box.remove();

return out;

}


  btn.addEventListener("click", run);
})();
</script>
<!-- NG_SMOKE_TEST_BUTTON_V1_END -->

<script src="ng_add_byte_multirow_v3.js"></script>


<!-- NG_TOOLBAR_MINI_JS_V1_INCLUDE_START (20260130) -->
<script src="./js/ng_toolbar_mini_v1.js"></script>
<!-- NG_TOOLBAR_MINI_JS_V1_INCLUDE_END -->

<!-- NG_TOOLBAR_ACTIONS_JS_V1_INCLUDE_START (20260130) -->
<!-- NG_TOOLBAR_ACTIONS_JS_V1_INCLUDE_END -->

<!-- NG_GENERATE_JS_V1_INCLUDE_START (20260130) -->
<script src="./js/ng_generate_v1.js"></script>
<!-- NG_GENERATE_JS_V1_INCLUDE_END -->

<!-- NG_PROMPT_BUILDER_V1_INCLUDE_START (20260130) -->
<!-- NG_PROMPT_BUILDER_V1_INCLUDE_END -->
<script src="/script1_dump.js?v=20260131" defer></script>

<script>
/* Patch Override ... */
</script>

<script>
/* NG_MOVE_ADD_TO_BYTES_V1 (20260203) */
(() => {
  function move() {
    const holder = document.getElementById("ng-add-final-holder");
    const btn = document.getElementById("ng-add-final");
    if (!holder || !btn) return;

    // Prefer placing near Final Bytes area
    const target =
      document.getElementById("ng-final-bytes-list-auto") ||
      document.getElementById("bytesWrap") ||
      document.getElementById("ng-manual-bytes");

    if (!target) return;

    // Put holder at top of target (or just before +Add Byte if it exists)
    const addByteBtn = target.querySelector('button, input[type="button"], input[type="submit"]');
    if (addByteBtn && addByteBtn !== btn && addByteBtn.parentElement === target) {
      target.insertBefore(holder, addByteBtn);
    } else {
      target.insertBefore(holder, target.firstChild);
    }

    // Make it look like a normal in-panel action (no floating feel)
    holder.style.display = "flex";
    holder.style.justifyContent = "flex-start";
    holder.style.margin = "8px 0 10px";
    btn.style.position = "static";
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", move, { once: true });
  } else {
    move();
  }
})();
</script>

<script>
/* NG_BYTES_CONTROLS_ROW_V5 (20260203) */
/* Best practice: JS only places elements; CSS controls layout */
(() => {
  function findTitle(root, label){
    const want = (label||"").toLowerCase();
    const nodes = Array.from(root.querySelectorAll("h1,h2,h3,h4,h5,b,strong,div,span,p"))
      .filter(n => (n.textContent||"").trim().toLowerCase() === want);
    return nodes[0] || null;
  }

  function arrange() {
    const bytesWrap = document.getElementById("bytesWrap");
    const addByteBtn = document.getElementById("addByteBtn");
    const addFinalBtn = document.getElementById("ng-add-final");
    if (!bytesWrap || !addByteBtn || !addFinalBtn) return;

    // stable controls container
    let row = document.getElementById("ng-bytes-controls-row");
    if (!row) {
      row = document.createElement("div");
      row.id = "ng-bytes-controls-row";
    }

    // CSS is source of truth (remove legacy inline styles if any)
    row.removeAttribute("style");

    const bytesTitle = findTitle(bytesWrap, "Bytes");
    const finalTitle = findTitle(bytesWrap, "Final Bytes");

    // Desired order: Bytes -> controls -> Final Bytes
    if (finalTitle) {
      bytesWrap.insertBefore(row, finalTitle);
    } else if (bytesTitle) {
      bytesTitle.insertAdjacentElement("afterend", row);
    } else {
      bytesWrap.insertBefore(row, bytesWrap.firstChild);
    }

    // Inside controls: +Add Byte then Add to Bytes
    row.appendChild(addByteBtn);
    row.appendChild(addFinalBtn);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", arrange, { once: true });
  } else {
    arrange();
  }
})();
</script>

<!-- === NG_UI_LOG_RINGBUFFER_V1_START (20260203) === -->
<script>
(function(){
  if (window.__NG_UI_LOG_RINGBUFFER_V1__) return;
  window.__NG_UI_LOG_RINGBUFFER_V1__ = true;

  var MAX = 10;
  var buf = [];

  function safeStr(x){
    try {
      if (x instanceof Error) return (x.stack || x.message || String(x));
      if (typeof x === "string") return x;
      if (x == null) return "";
      if (typeof x === "object") return JSON.stringify(x);
      return String(x);
    } catch(e){
      try { return String(x); } catch(_){ return ""; }
    }
  }

  function push(level, args){
    var ts = new Date().toISOString().slice(11,19); // HH:MM:SS
    var msg = Array.prototype.slice.call(args || []).map(safeStr).join(" ");
    var tag = level === "error" ? "[ERR]" : (level === "warn" ? "[WARN]" : "[LOG]");
    var line = ts + " " + tag + " " + msg;
    buf.push(line);
    if (buf.length > MAX) buf = buf.slice(buf.length - MAX);
    render();
  }

  function render(){
    var el = document.getElementById("ngLog");
    if (!el) return;
    el.textContent = buf.join("\n");
  }

  // Hook console methods (do not break original console)
  try {
    var origLog = console.log.bind(console);
    var origWarn = console.warn.bind(console);
    var origErr = console.error.bind(console);

    console.log = function(){ try { origLog.apply(console, arguments); } catch(e){} push("log", arguments); };
    console.warn = function(){ try { origWarn.apply(console, arguments); } catch(e){} push("warn", arguments); };
    console.error = function(){ try { origErr.apply(console, arguments); } catch(e){} push("error", arguments); };
  } catch(e) {}

  // In case logs happen before DOM element exists
  setTimeout(render, 0);
  setTimeout(render, 250);
})();
</script>
<!-- === NG_UI_LOG_RINGBUFFER_V1_END === -->
<script>
/* === NG_OUTPUT_TABS_JS_V1_START (20260204) === */
(function(){
  if (window.__NG_OUTPUT_TABS_JS_V1__) return;
  window.__NG_OUTPUT_TABS_JS_V1__ = true;
function NG_setOutputReady(on){
  try{
    const q = document.getElementById("ng-tab-quick");
    const l = document.getElementById("ng-tab-log");
    const r = document.getElementById("ng-tab-raw");
    if (q) q.disabled = !on;
    if (l) l.disabled = !on;
    if (r) r.disabled = !on;
  }catch(e){}
}
window.NG_setOutputReady = NG_setOutputReady;


  function setTab(t){
window.setTab = setTab;

    try{ document.documentElement.setAttribute("data-ng-outtab", t); }catch(e){}
    if (t === "story") {
      try{
        document.body.classList.add("ng-show-storyview");
        var p = document.getElementById("ng-storyview");
        if (p) p.style.display = "block";
        if (typeof window.NG_fillStoryView === "function") window.NG_fillStoryView();
      }catch(e){}
    }
  }

  function boot(){
  var bStory = document.getElementById("ng-tab-story");
  var bQuick = document.getElementById("ng-tab-quick");
  var bLog   = document.getElementById("ng-tab-log");
  var bRaw   = document.getElementById("ng-tab-raw");

  if (bStory) bStory.addEventListener("click", function(){ setTab("story"); });
  if (bQuick) bQuick.addEventListener("click", function(){ setTab("quick"); });
  if (bLog)   bLog.addEventListener("click", function(){ setTab("log"); });
  if (bRaw)   bRaw.addEventListener("click", function(){ setTab("raw"); });

  // default: disable optional tabs until first output exists
  try{ if (typeof NG_setOutputReady === "function") NG_setOutputReady(false); }catch(e){}

  // default tab
  setTab("quick");

  // sync: toolbar Story View button
  document.addEventListener("click", function(e){
    var id = e && e.target && e.target.id;
    if (id === "ng-ui-storyview") setTab("story");
  }, true);
}
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", boot, { once:true });
  } else {
    boot();
  }
})();

</script>
<!-- === NG_OUTPUT_TABS_JS_V1_END === -->


<!-- === NG_JSON_PANEL_TOGGLE_V1_START (2026-02-06) === -->
<script>
(function(){
  function getOutTab(){
    try{
      return String(
        (document.documentElement && document.documentElement.getAttribute("data-ng-outtab")) || ""
      ).toLowerCase();
    }catch(e){ return ""; }
  }

  function apply(){
    try{
      var t = getOutTab();
      var show = (t === "raw" || t === "json");
      var panel = document.getElementById("ng-json-panel-wrap");
      if (!panel) return;

      panel.style.display = show ? "block" : "none";

      if (show && typeof window.NG_renderJsonTab === "function"){
        setTimeout(window.NG_renderJsonTab, 10);
      }
    }catch(e){}
  }

  document.addEventListener("click", function(){
    setTimeout(apply, 20);
  }, true);

  setTimeout(apply, 120);

  window.NG_applyJsonPanelVisibility = apply;
})();
</script>
<!-- === NG_JSON_PANEL_TOGGLE_V1_END === -->




</body>
<script id="ng-runtime-flags">
/* NG_EE_AUTOINIT_DISABLED_V1_START (20260205)
   EE disabled intentionally (no UI / no init)
*/
window.__NG_DISABLE_EE__ = true;
try { console.log('[EE] autoinit disabled by NG_EE_AUTOINIT_DISABLED_V1'); } catch(e) {}
/* NG_EE_AUTOINIT_DISABLED_V1_END */

/* NG_FINAL_BYTES_UI_POLL_NOTES_V1_START (20260205)
Public API: call this only from explicit UI actions
DISABLED: overwrote NG_refreshFinalBytes
window.NG_refreshFinalBytes_DISABLED = function(){
  window.__NG_ALLOW_BYTES_LATEST_ONCE = true;
  return tick("manual");
}
// NO auto-run, NO visibilitychange, NO global click hooks
// You can trigger refresh after POST success manually if needed (see next note).
NG_FINAL_BYTES_UI_POLL_NOTES_V1_END */
</script>
<script>
/* === NG_STORYVIEW_WIRE_V1_START (20260206) === */
(() => {
  function getOuttab() {
    const de = document.documentElement;
    const b = document.body;
    return (de && de.getAttribute("data-ng-outtab")) || (b && b.getAttribute("data-ng-outtab")) || "";
  }

  function readNgResponseJSON() {
    const pre = document.getElementById("ngResponse");
    if (!pre) return null;
    const raw = (pre.textContent || "").trim();
    if (!raw) return null;
    try { return JSON.parse(raw); } catch(e) { return { __raw: raw, __parse_error: true }; }
  }

  function renderStoryView() {
  try {
    const tab = getOuttab();
    if (tab !== "story") return;

    // FORCE show wrapper + story panel (fix hidden parent)
    const wrap = document.getElementById("ng-response-panel-wrap");
    if (wrap) wrap.style.setProperty("display", "block", "important");
    const sv = document.getElementById("ng-storyview");
    if (sv) sv.style.setProperty("display", "block", "important");


      const out = document.getElementById("ng-storyview-out");
      const fmt = document.getElementById("ng-storyview-formatted");
      if (!out && !fmt) return;

      const j = readNgResponseJSON();
      let text = "";

      // Prefer "copy_text" (human readable), else output_json pretty, else raw
      if (j && typeof j === "object") {
  // unwrap if needed
  if (j.output_json && typeof j.output_json === "object") j = j.output_json;

  // 1) If backend gives ready detailed text, use it
  if (typeof j.copy_text === "string" && j.copy_text.trim()) {
    text = j.copy_text.trim();
  } else {
    // 2) Build readable detailed text from common keys (no JSON dump)
    const lines = [];
    const add = (label, val) => {
  if (val == null) return;

  // If array → join
  if (Array.isArray(val)) {
    const arr = val.map(x => (x == null ? "" : String(x).trim())).filter(Boolean);
    if (!arr.length) return;
    lines.push(`## ${label}\n${arr.join("\n")}\n`);
    return;
  }

  // If object → render key:value lines
  if (typeof val === "object") {
    const keys = Object.keys(val || {});
    if (!keys.length) return;

    const parts = [];
    keys.forEach(k => {
      const v = val[k];
      if (v == null) return;
      if (typeof v === "string" && v.trim()) parts.push(`${k}: ${v.trim()}`);
      else if (Array.isArray(v) && v.length) parts.push(`${k}: ${v.join(" | ")}`);
    });

    if (!parts.length) parts.push(JSON.stringify(val, null, 2));

    lines.push(`${label}\n${"-".repeat(label.length)}\n${parts.join("\n")}\n`);

    return;
  }

  // string/number/bool
  const s = String(val).trim();
  if (!s) return;
  lines.push(`${label}\n${"-".repeat(label.length)}\n${s}\n`);

};

    const addList = (label, arr) => {
      if (!Array.isArray(arr) || !arr.length) return;
      lines.push(`${label}\n${"-".repeat(label.length)}`);

      arr.forEach(it => {
        if (it == null) return;
        const s = (typeof it === "string") ? it.trim() : "";
        if (s) lines.push(`- ${s}`);
      });
      lines.push("");
    };

    add("Headline", j.headline);
    add("Summary", j.summary);
addList("Key Points", j.key_points);
  // --- Web Article (longform) ---
  try{
   var wa = (j && (j.web_article || j.web || j.article)) || null;

    if (wa){


      add("Web Article Title", wa.title || wa.headline || "");
      add("Web Article Dek", wa.dek || wa.subhead || wa.summary || "");
      add("Web Article Body", wa.body || wa.text || wa.content || "");
    }
  }catch(e){}

add("YouTube Title", j.youtube_title || (j.youtube && j.youtube.title));
add("YouTube Description", j.youtube_description || (j.youtube && j.youtube.description));
add("YouTube Video Script", j.youtube_script || j.video_script || j.yt_script || (j.youtube && j.youtube.script));
add("YouTube VO (optional)", j.youtube_vo || (j.youtube && j.youtube.vo));
// --- Reel / Shorts (short-form) ---
try{
  var r = j.reel || j.short || j.shorts || null;
  if (r){
    add("Reel Hook", r.hook || r.opening || r.hook_line || r.one_liner || "");

    add("Reel Script", r.script || r.vo || "");
    add("Reel CTA", r.cta || "");
  }
}catch(e){}

// --- Social (distribution) ---
try{
  var s = j.social || null;
  if (s){
    add("Instagram Caption", s.instagram_caption || s.instagram || "");
add("Hashtags", s.hashtags || s.tags || s.hash || s.keywords || "");

    add("X Post", s.x_post || s.twitter || "");
addList("X Thread", Array.isArray(s.x) ? s.x : []);
if (!Array.isArray(s.x)) add("X Post", s.x || "");

    add("WhatsApp", s.whatsapp || "");
   

  }
}catch(e){}
// --- SEO Pack ---
try{
  // support both root keys and nested seo object
  var seo = j.seo || j.seo_pack || null;

  add("SEO Meta Title", (seo && (seo.meta_title || seo.title)) || j.meta_title || "");
  add("SEO Meta Description", (seo && (seo.meta_description || seo.description)) || j.meta_description || "");
  add("SEO Slug", (seo && (seo.slug)) || j.slug || "");
  add("SEO Keywords", (seo && (seo.keywords || seo.tags)) || j.seo_keywords || j.keywords || "");
}catch(e){}

// --- References / Links ---
try{
  var refs = j.refs || j.references || j.links || null;
  if (refs) add("References", refs);
}catch(e){}


    // common arrays
    
    addList("Bullets", j.bullets);
    addList("GFX Bullets", j.gfx_bullets);
    addList("Teleprompter", j.tp);

    // if there is a socials object, show selected fields as text
    if (j.socials && typeof j.socials === "object") {
      add("Social (X)", j.socials.x || j.socials.twitter);
      add("Social (Instagram)", j.socials.instagram);
      add("Social (YouTube)", j.socials.youtube);
      add("Social (WhatsApp)", j.socials.whatsapp);
    }

    text = lines.join("\n").trim();
    if (!text) text = "(StoryView: detailed text fields नहीं मिले।)";
  }
}

      if (!text) text = "(StoryView: no output yet. Generate DIGI_PACK first.)";

      if (out) out.textContent = text;
      if (fmt) fmt.textContent = ""; // keep formatted empty for now (later we can build cards)
    } catch(e) {}
  }

  // Run on tab change (attribute mutation) + after ngResponse updates
  const mo = new MutationObserver(() => renderStoryView());
  try {
    mo.observe(document.documentElement, { attributes:true, attributeFilter:["data-ng-outtab"] });
    mo.observe(document.body, { attributes:true, attributeFilter:["data-ng-outtab"] });
  } catch(e) {}

  const pre = document.getElementById("ngResponse");
  if (pre) {
    const mo2 = new MutationObserver(() => renderStoryView());
    try { mo2.observe(pre, { childList:true, subtree:true, characterData:true }); } catch(e) {}
  }

  // First paint
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", renderStoryView, { once:true });
  } else {
    renderStoryView();
  }
function renderJsonTab() {
  try {
    const tab = getOuttab();
    if (tab !== "raw" && tab !== "json") return;


    const raw = (document.getElementById("ngResponse")?.textContent || "").trim();
    const out = document.getElementById("ng-json-out");
    if (out) out.textContent = raw || "(no JSON yet)";
  } catch(e) {}
}


  // Expose manual hook for debugging
  window.NG_renderStoryView = renderStoryView;
})();
</script>


<!-- === NG_JSON_TAB_RENDERER_V1_START (2026-02-06) === -->
<script>
(function(){
  window.NG_renderJsonTab = function(){
    try{
      var pre = document.getElementById("ngResponse");
      var out = document.getElementById("ng-json-out");
      if (!pre || !out) return;

      var txt = (pre.textContent || pre.innerText || "").trim();
      if (!txt){
        out.textContent = "(empty) Generate first, then open JSON tab.";
        return;
      }

      var pretty = "";
      try{
        var j = JSON.parse(txt);
        pretty = JSON.stringify(j, null, 2);
      }catch(e){
        var m = txt.match(/(\{[\s\S]*\}|\[[\s\S]*\])\s*$/);
        if (m){
          try{
            var j2 = JSON.parse(m[1]);
            pretty = JSON.stringify(j2, null, 2);
          }catch(e2){ pretty = txt; }
        } else {
          pretty = txt;
        }
      }
      out.textContent = pretty;
    }catch(e){}
  };

  function getOutTab(){
    try{
      var v =
        (window.__NG_OUTTAB != null ? window.__NG_OUTTAB : null) ||
        (document.documentElement && document.documentElement.getAttribute("data-ng-outtab")) ||
        (localStorage.getItem("NG_OUTTAB")) ||
        (localStorage.getItem("ng_outtab")) ||
        "";
      return String(v || "").toLowerCase();
    }catch(e){ return ""; }
  }

  function isJsonActive(){
    var t = getOutTab();
    return (t === "raw" || t === "json");
  }

  function safeRender(){
    try{
      if (!isJsonActive()) return;
      if (typeof window.NG_renderJsonTab === "function") window.NG_renderJsonTab();
    }catch(e){}
  }

  document.addEventListener("click", function(){
    setTimeout(safeRender, 30);
  }, true);

  try{
    var panel = document.getElementById("ng-json-panel-wrap");
    if (panel && window.MutationObserver){
      var mo = new MutationObserver(function(){
        try{
          var ds = (panel.style && panel.style.display) ? panel.style.display : "";
          if (ds !== "none") setTimeout(safeRender, 10);
        }catch(e){}
      });
      mo.observe(panel, { attributes:true, attributeFilter:["style","class"] });
    }
  }catch(e){}

  function wrapSetter(fnName){
    try{
      var fn = window[fnName];
      if (typeof fn !== "function" || fn.__ngWrapped) return;
      function wrapped(){
        var r = fn.apply(this, arguments);
        setTimeout(safeRender, 20);
        return r;
      }
      wrapped.__ngWrapped = true;
      window[fnName] = wrapped;
    }catch(e){}
  }
  wrapSetter("setOutTab");
  wrapSetter("NG_setOutTab");
  wrapSetter("ngSetOutTab");

  setTimeout(safeRender, 150);
})();
</script>
<!-- === NG_JSON_TAB_RENDERER_V1_END === -->
<!-- === NG_COPY_STORYVIEW_V1_START (2026-02-07) === -->
<script>
(function(){
  async function copyTextToClipboard(text){
    text = (text == null) ? "" : String(text);
    // Prefer modern clipboard API
    try{
      if (navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(text);
        return true;
      }
    }catch(e){}
    // Fallback
    try{
      var ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly", "");
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      ta.style.top = "0";
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      var ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return !!ok;
    }catch(e){}
    return false;
  }

  document.addEventListener("click", async function(e){
    var id = e && e.target && e.target.id;
    if (id !== "ngCopyStoryView") return;

    var el = document.getElementById("ng-storyview-out");
    var txt = el ? (el.innerText || el.textContent || "") : "";
    var ok = await copyTextToClipboard(txt);

    // optional tiny feedback (safe)
    try{
      var b = document.getElementById("ngCopyStoryView");
      if (b){
        var old = b.textContent;
        b.textContent = ok ? "Copied ✓" : "Copy failed";
        setTimeout(function(){ b.textContent = old; }, 900);
      }
    }catch(_){}
  }, true);
})();
</script>
<!-- === NG_COPY_STORYVIEW_V1_END === -->


<!-- /* === NG_STORYVIEW_WIRE_V1_END === */ -->



</html>





















































































